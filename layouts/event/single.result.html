{{ define "main" }}

{{ $resultFile := "" }}
{{ with .Resources.GetMatch "results/*.xml" }}

{{ $resultFile = .Title}}

{{ end }}

{{ $f := string (delimit (slice "" "content" "event" "2019" "sbgcup" "01" $resultFile) "/") }}

{{ $xml := getXML $f }}

<div class="uk-container">
    <h3 class="uk-text-center">{{$xml.ResultList.Event.Name}}
        {{ with $xml.note.from }} - {{.}} {{ end }}</h3>
</div>
<div class="uk-container">
    <table id="" class="display datatable" style="width:100%">
        <thead>
            <tr>
                <th>Pl</th>
                <th>Kategorie</th>
                <th>Name</th>
                <th>Jg</th>
                <th>Verein</th>
                <th>Zeit</th>
                <th>Diff.</th>
            </tr>
        </thead>
        <tbody>
        {{ range $xml.ResultList.ClassResult }}

        {{ $count := 0 }}
            <!-- 
        <div>
            <h5><nobr>{{.Class.Name}} ({{$count}}) - Bahn: {{.Course.Name}}</nobr>{{.Course.Length}} m, {{.Course.NumberOfControls}} P</h5>
        </div>
 -->
            {{ range $i, $p := .PersonResult }}
                {{ if eq $i "Person" }}
                    {{ $count = 0 }}
                {{ else }}
                    {{ $count = add $count 1 }}
                {{ end }}
            {{ end }}
            {{ $className := (print .Class.Name " (" $count ") - Bahn: " .Course.Name ", " .Course.Length " m, " .Course.NumberOfControls " P" ) }}
            {{ $plOffset := 1 }}
            {{ if eq $count 1 }}
                {{ partial "result/result_row" (dict "personresult" .PersonResult "ploffset" $plOffset "cat" $className) }}
            {{ else }}
                {{ range $i, $p := .PersonResult }}
                    {{ partial "result/result_row" (dict "personresult" $p "ploffset" $plOffset "cat" $className) }}
                    {{ $plOffset = add $plOffset 1 }}
                {{ end }}
            {{ end }}
        {{ end }}
        </tbody>
    </table>
</div>
    <style>
    div.dataTables_wrapper {
        margin-bottom: 3em;
    }</style>
    <script type="text/javascript">
        $(document).ready( function () {
            $('table.display').DataTable({
                paging: false,
                info: false,
                searching: false,
                responsive: true,
                order: [[1, 'asc']],
                rowGroup: {
                    startRender: function ( rows, group ) {
                        return $('<tr/>')
                                .append( '<td colspan="7">'+group+'</td>' );
                        },
                    dataSrc: 1
                },
                columnDefs: [
                    { "visible": false, "targets": 1 }
                ]
            });
        });
        </script>
{{ end }}


